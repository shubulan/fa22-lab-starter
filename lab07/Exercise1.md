# Exercise 1 缓存练习

## Scenario 1
程序参数
* 数组大小：32
* 步长：8
* 重复次数：4
* option：0

缓存规格

* 缓存级数：1
* Block size：8
* Number of Blocks：4
* 连接性：1
* Block 替换策略：LRU

32 个元素，步长为 8 ，因此我们将访问 4 个元素 0 8 16 24
偏移量计算如下：
* 0：0 x 4 = 0
* 8：8 x 4 = 32
* 16：16 x 4 = 64
* 24：24 x 4 = 96

设数组地址为 0，则元素地址更简单

|set| valid | tag | data |
|---| ----- | --- | ---- |
|00 |0      |     |      |
|01 |0      |     |      |
|10 |0      |     |      |
|11 |0      |     |      |

根据缓存规格，很容易算出 TIO
tag: 32 - 5 = 27 位
idx: 2 位
off: 3 位

### 访问 0
0x00000000
|set| valid | tag | data1 | data0|
|---| ----- | --- | ---- | --- |
|00 |1      |0x0000000| 5 | 0  |
|01 |0      |     |      |
|10 |0      |     |      |
|11 |0      |     |      |
### 访问 8
0x00000020
|set| valid | tag | data1 | data0|
|---| ----- | --- | ---- | --- |
|00 |1      |0x0000001| 5 | 0  |
|01 |0      |      |   |      |
|10 |0      |     |      |
|11 |0      |     |      |

### 访问 16
0x00000040
|set| valid | tag | data1 | data0|
|---| ----- | --- | ---- | --- |
|00 |1      |0x0000002| 5 | 0  |
|01 |0      |      |   |      |
|10 |0      |     |      |
|11 |0      |     |      |

## 访问 24
0x00000060
|set| valid | tag | data1 | data0|
|---| ----- | --- | ---- | --- |
|00 |1      |0x0000003| 5 | 0  |
|01 |0      |      |   |      |
|10 |0      |     |      |
|11 |0      |     |      |

## 如何确认缓存未命中的类型：
1. 考虑，如果是全连接，无限缓存，会未命中么？如果仍然会，那么就是 Compulsory miss，如果不会，那么继续向下
2. 考虑如果全连接，但是有限缓存，会未命中么？如果会，那么就是 capacity miss
3. 考虑如果有限连接，有限缓存，会未命中么？如果会，那么就是 confilict miss


## 表格中的问题
1. 一次迭代发生了几次内存访问：1次
2. 命中率是0因为 缓存大小 和 步长 完全相等
3. 以下哪些改变能够提高命中率？
   * 使用全连接缓存
   * 增加 blocksize 到 32
   * 增加 blocksize 到 64

## Scenario 2

* 数组大小 64
* 步长 2
* 重复次数 1
* 选项 1

* 缓存级数 1
* block size 16
* number of block 16
* 链接性 2
* 替换策略 LRU
访问 32 个 位置， 0 2 4 ...

tag: 32 - 7 = 25 位
idx: 3 位
off: 4 位

0x00000000
0x00000008
0x00000010

## 表格中的问题

1. 每次迭代发生几次内存访问？2 次，一次读取，一次写入
2. 访问的 hit/miss 模式是什么？
   * mh
3. 其他所有的都不变，如果把关联性改到1，命中率会变化么？
   * 不会。全是 Compulsory 不命中
4. 其他都保持不变，如果rep变成无限，命中率会是多少？
   * 100%，缓存刚好够把所有内容装下

## Scenario 3
数组大小：32
步长：1
重复次数： 1
option:0
缓存级数：2
L1:
blockSize:8
number of blocks:8
替换策略： 无。。
关联性：直接映射
L2:
block:Size:8
Number of Blocks:16
关联性：直接映射
替换策略：LRU

### 表格问题

1. 访问了多少次 L1 缓存？ 32 次
2. L1 缓存多少次 miss ? 16 次
3. Li 缓存命中率：50%
4. 访问了多少次 L2 缓存？ 16 次
5. L2 缓存命中率？50%
6. 总体命中率？
   * 总共32次访问16次命中L1,16次未命中中，8次命中了L2缓存因此 25%
7. 改变什么参数会导致L2命中率增加，而L1命中率不变？
   * rep count -> L1 缓存是数组的一半，不管rep 多少次，hit/miss 模式是一样的，命中率不变。L2 刚好装满所有的数组。随着 rep 增加，后续会全部命中。

8. 增加L1 的 block数量， L1 L2 命中率会有什么变化？增加 L1 block size ，L1 L2 命中率有什么变化？

增加 L1 block 数量：

* L1: 不变，全是 Compulsory 
* L2: 不变，这能有啥变化

增加 L1 block 大小

* L1: 增加
* L2: 减小: L1 变大了，对应的 L2 的访问此时变少了，L2 不命中的概率相对增加了。